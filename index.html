<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام معاينات EPS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00a8e8;
            --primary-dark: #0077b6;
            --secondary: #ff6b6b;
            --accent: #4ecdc4;
            --light: #f8f9fa;
            --dark: #2d3436;
            --gray: #636e72;
            --success: #00b894;
            --warning: #fdcb6e;
            --gradient: linear-gradient(135deg, #00a8e8 0%, #4ecdc4 100%);
            --gradient-dark: linear-gradient(135deg, #0077b6 0%, #3da39d 100%);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Tajawal', sans-serif;
        }
        
        body {
            background-color: #f0f5f9;
            color: var(--dark);
            line-height: 1.7;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Background elements */
        .background-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(0, 168, 232, 0.05);
            animation: float 15s infinite ease-in-out;
        }
        
        .bubble:nth-child(1) {
            width: 120px;
            height: 120px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .bubble:nth-child(2) {
            width: 80px;
            height: 80px;
            top: 20%;
            right: 15%;
            animation-delay: 2s;
            background: rgba(78, 205, 196, 0.05);
        }
        
        .bubble:nth-child(3) {
            width: 150px;
            height: 150px;
            bottom: 15%;
            left: 5%;
            animation-delay: 4s;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .bubble:nth-child(4) {
            width: 100px;
            height: 100px;
            bottom: 10%;
            right: 10%;
            animation-delay: 6s;
        }
        
        .bubble:nth-child(5) {
            width: 60px;
            height: 60px;
            top: 50%;
            left: 20%;
            animation-delay: 8s;
            background: rgba(0, 184, 148, 0.05);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(10px) rotate(240deg); }
        }
        
        .floating-icon {
            position: absolute;
            font-size: 2rem;
            color: rgba(0, 168, 232, 0.1);
            animation: pulse 4s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }
        
        .floating-icon:nth-child(6) {
            top: 15%;
            right: 5%;
            animation-delay: 0.5s;
        }
        
        .floating-icon:nth-child(7) {
            bottom: 20%;
            left: 8%;
            animation-delay: 1s;
        }
        
        .floating-icon:nth-child(8) {
            top: 40%;
            right: 20%;
            animation-delay: 1.5s;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            background: var(--gradient);
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 5px 20px rgba(0, 168, 232, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            background: rgba(255, 255, 255, 0.2);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            backdrop-filter: blur(5px);
        }
        
        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        
        .logo-text span {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .header-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z' fill='%23f0f5f9'%3E%3C/path%3E%3C/svg%3E");
            background-size: 1200px 100%;
        }
        
        /* Progress Steps - Updated to 3 steps */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin: 40px auto;
            max-width: 900px;
            position: relative;
        }
        
        .progress-steps::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: #e0e0e0;
            transform: translateY(-50%);
            z-index: 1;
        }
        
        .progress-bar {
            position: absolute;
            top: 50%;
            left: 0;
            height: 4px;
            background: var(--primary);
            transform: translateY(-50%);
            transition: width 0.5s ease;
            z-index: 2;
        }
        
        .step {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            border: 4px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--gray);
            position: relative;
            z-index: 3;
            transition: all 0.3s ease;
        }
        
        .step.active {
            border-color: var(--primary);
            color: var(--primary);
            background: white;
            box-shadow: 0 0 0 8px rgba(0, 168, 232, 0.1);
        }
        
        .step.completed {
            border-color: var(--success);
            background: var(--success);
            color: white;
        }
        
        .step-label {
            position: absolute;
            top: 60px;
            width: 120px;
            text-align: center;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .step.active .step-label {
            color: var(--primary);
            font-weight: bold;
        }
        
        /* Form Sections */
        .form-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 40px;
            overflow: hidden;
            transform: translateY(0);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .form-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .section-header {
            background: var(--gradient-dark);
            color: white;
            padding: 25px 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-icon {
            background: rgba(255, 255, 255, 0.2);
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            backdrop-filter: blur(5px);
        }
        
        .section-header h2 {
            font-size: 1.6rem;
            font-weight: 700;
        }
        
        .section-header p {
            opacity: 0.9;
            font-size: 0.95rem;
            margin-top: 5px;
        }
        
        .section-body {
            padding: 30px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .form-group {
            flex: 1;
            min-width: 300px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group label i {
            color: var(--primary);
        }
        
        .form-control {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 168, 232, 0.1);
        }
        
        /* Auto fields */
        .auto-fields {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .auto-field {
            flex: 1;
            min-width: 200px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            border: 2px dashed #dee2e6;
        }
        
        .auto-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray);
        }
        
        .auto-field .value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        /* Icon Selection */
        .icon-selection {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .icon-option {
            flex: 1;
            min-width: 150px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .icon-option:hover {
            border-color: var(--primary);
            background: rgba(0, 168, 232, 0.05);
        }
        
        .icon-option.selected {
            border-color: var(--primary);
            background: rgba(0, 168, 232, 0.1);
            box-shadow: 0 0 0 4px rgba(0, 168, 232, 0.1);
        }
        
        .icon-option i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--gray);
        }
        
        .icon-option.selected i {
            color: var(--primary);
        }
        
        .icon-option span {
            font-weight: 600;
            color: var(--dark);
        }
        
        /* Shift Cards */
        .shift-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }
        
        .shift-card:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .shift-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .shift-header h3 {
            color: var(--primary);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .time-selection {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .time-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .time-group label {
            font-weight: 600;
            color: var(--dark);
        }
        
        /* Service Rows in Shifts */
        .service-rows {
            margin-top: 20px;
        }
        
        .service-row {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }
        
        .service-row select, .service-row input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .add-service-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .add-service-btn:hover {
            background: var(--primary-dark);
        }
        
        .remove-service-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 6px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        /* Statistics Section */
        .stats-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 2px solid #e9ecef;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border-top: 4px solid var(--primary);
        }
        
        .stat-card .number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-card .label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Alternate Rest Field */
        .alternate-rest-field {
            background: #e3f2fd;
            border: 2px solid #bbdefb;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
        }
        
        .alternate-rest-field.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Service Selection Dropdown */
        .service-dropdown-section {
            margin-bottom: 30px;
        }
        
        .service-dropdown {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--primary);
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
            background: white;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .service-dropdown option {
            padding: 10px;
            font-size: 1rem;
        }
        
        /* Items Table */
        .items-section {
            display: none;
        }
        
        .items-section.active {
            display: block;
            animation: slideIn 0.5s;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .items-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: right;
            font-weight: 700;
            color: var(--dark);
            border-bottom: 2px solid #e9ecef;
        }
        
        .items-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .item-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .item-name i {
            color: var(--primary);
        }
        
        .quantity-input {
            width: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
        }
        
        .unit-select {
            width: 120px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        
        /* Tabs for service items */
        .service-tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .service-tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .service-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(0, 168, 232, 0.05);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Buttons */
        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e9ecef;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--gradient);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--gradient-dark);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 168, 232, 0.2);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: var(--dark);
            border: 2px solid #e9ecef;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }
        
        .btn-next {
            background: var(--success);
            color: white;
        }
        
        .btn-next:hover {
            background: #00a085;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 184, 148, 0.2);
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 40px 0;
            margin-top: 60px;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .footer-logo h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .footer-logo span {
            color: var(--accent);
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            margin-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .form-group {
                min-width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .icon-option {
                min-width: 120px;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .progress-steps {
                margin: 30px auto;
            }
            
            .step-label {
                width: 80px;
                font-size: 0.8rem;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .service-tabs {
                flex-wrap: wrap;
            }
            
            .service-tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
            
            .service-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .time-selection {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        
        @media (max-width: 576px) {
            .section-body {
                padding: 20px;
            }
            
            .section-header {
                padding: 20px;
                flex-direction: column;
                text-align: center;
            }
            
            .auto-fields {
                flex-direction: column;
            }
            
            .icon-option {
                min-width: 100%;
            }
            
            .shift-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Background elements -->
    <div class="background-elements">
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <i class="fas fa-broom floating-icon"></i>
        <i class="fas fa-utensils floating-icon"></i>
        <i class="fas fa-tools floating-icon"></i>
    </div>
    
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="logo-text">
                        <h1>EPS نظام المعاينات</h1>
                        <span>شركة خدمات متكاملة</span>
                    </div>
                </div>
                <div class="current-date">
                    <i class="far fa-calendar-alt"></i>
                    <span id="currentDate"></span>
                </div>
            </div>
        </div>
        <div class="header-wave"></div>
    </header>
    
    <div class="container">
        <!-- Progress Steps - Updated to 3 steps -->
        <div class="progress-steps">
            <div class="progress-bar" id="progressBar" style="width: 33%"></div>
            <div class="step active" id="step1">
                <span>1</span>
                <div class="step-label">المعلومات العامة</div>
            </div>
            <div class="step" id="step2">
                <span>2</span>
                <div class="step-label">المواعيد والعمالة</div>
            </div>
            <div class="step" id="step3">
                <span>3</span>
                <div class="step-label">الخدمات والبنود</div>
            </div>
        </div>
        
        <!-- General Information Form - Step 1 -->
        <div class="form-container" id="generalInfoForm">
            <div class="section-header">
                <div class="section-icon">
                    <i class="fas fa-building"></i>
                </div>
                <div>
                    <h2>المعلومات العامة</h2>
                    <p>معلومات المنشأة والتفاصيل الأساسية للمعاينة</p>
                </div>
            </div>
            
            <div class="section-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="establishmentName"><i class="fas fa-landmark"></i> اسم المنشأة</label>
                        <input type="text" id="establishmentName" class="form-control" placeholder="أدخل اسم المنشأة التي ستتم فيها المعاينة">
                    </div>
                    <div class="form-group">
                        <label for="establishmentAddress"><i class="fas fa-map-marker-alt"></i> عنوان المنشأة</label>
                        <input type="text" id="establishmentAddress" class="form-control" placeholder="أدخل العنوان الكامل للمنشأة">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="responsiblePerson"><i class="fas fa-user-tie"></i> الشخص المسؤول</label>
                        <input type="text" id="responsiblePerson" class="form-control" placeholder="اسم الشخص المسؤول في المنشأة">
                    </div>
                    <div class="form-group">
                        <label for="responsiblePhone"><i class="fas fa-phone"></i> رقم تليفون الشخص المسؤول</label>
                        <input type="tel" id="responsiblePhone" class="form-control" placeholder="رقم التليفون">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="inspectorName"><i class="fas fa-user-check"></i> القائم بالمعاينة</label>
                        <input type="text" id="inspectorName" class="form-control" placeholder="اسم الشخص القائم بالمعاينة">
                    </div>
                </div>
                
                <div class="form-row">
                    <h3 style="width: 100%; margin-bottom: 15px; color: var(--primary);"><i class="fas fa-cogs"></i> البيانات التلقائية</h3>
                    <div class="auto-fields">
                        <div class="auto-field">
                            <label><i class="far fa-calendar"></i> التاريخ</label>
                            <div class="value" id="autoDate">يتم التحميل...</div>
                        </div>
                        <div class="auto-field">
                            <label><i class="fas fa-map-pin"></i> الموقع الجغرافي</label>
                            <div class="value" id="autoLocation">جاري التعرف على الموقع...</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="resetBtn">
                        <i class="fas fa-redo"></i> إعادة تعيين
                    </button>
                    <button type="button" class="btn btn-next" id="nextToSchedule">
                        التالي <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Schedule & Workforce Form - Step 2 -->
        <div class="form-container" id="scheduleForm" style="display: none;">
            <div class="section-header">
                <div class="section-icon">
                    <i class="far fa-clock"></i>
                </div>
                <div>
                    <h2>المواعيد والعمالة</h2>
                    <p>تفاصيل مواعيد العمل والعمالة والوجبات والتنقلات</p>
                </div>
            </div>
            
            <div class="section-body">
                <!-- عدد أيام العمل -->
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-calendar-day"></i> عدد أيام العمل</label>
                        <input type="number" id="workDays" class="form-control" min="1" value="5" onchange="checkWorkDays()">
                        <small style="color: var(--gray); display: block; margin-top: 5px;">إذا كان عدد الأيام أكثر من 5 سيتم تفعيل "بديل الراحات"</small>
                    </div>
                </div>
                
                <!-- الوجبة - أيقونات -->
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-utensils"></i> الوجبة</label>
                        <div class="icon-selection" id="mealSelection">
                            <div class="icon-option" data-value="breakfast">
                                <i class="fas fa-coffee"></i>
                                <span>إفطار</span>
                            </div>
                            <div class="icon-option" data-value="lunch">
                                <i class="fas fa-hamburger"></i>
                                <span>غداء</span>
                            </div>
                            <div class="icon-option" data-value="dinner">
                                <i class="fas fa-utensils"></i>
                                <span>عشاء</span>
                            </div>
                            <div class="icon-option" data-value="all">
                                <i class="fas fa-concierge-bell"></i>
                                <span>ثلاث وجبات</span>
                            </div>
                            <div class="icon-option" data-value="none">
                                <i class="fas fa-ban"></i>
                                <span>بدون وجبة</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- التنقلات - أيقونات -->
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-car"></i> التنقلات</label>
                        <div class="icon-selection" id="transportationSelection">
                            <div class="icon-option" data-value="company">
                                <i class="fas fa-bus"></i>
                                <span>مواصلات الشركة</span>
                            </div>
                            <div class="icon-option" data-value="personal">
                                <i class="fas fa-car"></i>
                                <span>مواصلات شخصية</span>
                            </div>
                            <div class="icon-option" data-value="public">
                                <i class="fas fa-subway"></i>
                                <span>مواصلات عامة</span>
                            </div>
                            <div class="icon-option" data-value="none">
                                <i class="fas fa-walking"></i>
                                <span>بدون تنقلات</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- الوردية الصباحية -->
                <div class="shift-card" id="morningShift">
                    <div class="shift-header">
                        <h3><i class="fas fa-sun"></i> الوردية الصباحية</h3>
                        <div class="time-selection">
                            <div class="time-group">
                                <label>من</label>
                                <input type="time" id="morningStart" class="form-control" style="width: auto;" value="08:00">
                            </div>
                            <div class="time-group">
                                <label>إلى</label>
                                <input type="time" id="morningEnd" class="form-control" style="width: auto;" value="16:00">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-male"></i> عدد العمال الذكور</label>
                            <input type="number" class="workforce-input male-workers" min="0" value="0" data-shift="morning" oninput="updateWorkforceStats()">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-female"></i> عدد العمال الإناث</label>
                            <input type="number" class="workforce-input female-workers" min="0" value="0" data-shift="morning" oninput="updateWorkforceStats()">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-user-tie"></i> عدد المشرفين الذكور</label>
                            <input type="number" class="workforce-input male-supervisors" min="0" value="0" data-shift="morning" oninput="updateWorkforceStats()">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-user-tie"></i> عدد المشرفين الإناث</label>
                            <input type="number" class="workforce-input female-supervisors" min="0" value="0" data-shift="morning" oninput="updateWorkforceStats()">
                        </div>
                    </div>
                    
                    <!-- خدمات الوردية الصباحية -->
                    <div class="service-rows" id="morningServices">
                        <h4><i class="fas fa-list"></i> الخدمات في هذه الوردية</h4>
                        <div class="service-row">
                            <select class="service-select" data-shift="morning">
                                <option value="">اختر الخدمة</option>
                                <option value="cleaning">النظافة</option>
                                <option value="buffet">البوفيه</option>
                                <option value="security">الأمن</option>
                                <option value="maintenance">الصيانة</option>
                            </select>
                            <input type="number" class="service-workers" min="0" value="0" placeholder="عدد العمال">
                            <button type="button" class="remove-service-btn" onclick="removeServiceRow(this)"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <button type="button" class="add-service-btn" onclick="addServiceRow('morning')">
                        <i class="fas fa-plus"></i> إضافة خدمة
                    </button>
                </div>
                
                <!-- الوردية المسائية -->
                <div class="shift-card" id="eveningShift">
                    <div class="shift-header">
                        <h3><i class="fas fa-moon"></i> الوردية المسائية</h3>
                        <div class="time-selection">
                            <div class="time-group">
                                <label>من</label>
                                <input type="time" id="eveningStart" class="form-control" style="width: auto;" value="16:00">
                            </div>
                            <div class="time-group">
                                <label>إلى</label>
                                <input type="time" id="eveningEnd" class="form-control" style="width: auto;" value="00:00">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-male"></i> عدد العمال الذكور</label>
                            <input type="number" class="workforce-input male-workers" min="0" value="0" data-shift="evening" oninput="updateWorkforceStats()">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-female"></i> عدد العمال الإناث</label>
                            <input type="number" class="workforce-input female-workers" min="0" value="0" data-shift="evening" oninput="updateWorkforceStats()">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-user-tie"></i> عدد المشرفين الذكور</label>
                            <input type="number" class="workforce-input male-supervisors" min="0" value="0" data-shift="evening" oninput="updateWorkforceStats()">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-user-tie"></i> عدد المشرفين الإناث</label>
                            <input type="number" class="workforce-input female-supervisors" min="0" value="0" data-shift="evening" oninput="updateWorkforceStats()">
                        </div>
                    </div>
                    
                    <!-- خدمات الوردية المسائية -->
                    <div class="service-rows" id="eveningServices">
                        <h4><i class="fas fa-list"></i> الخدمات في هذه الوردية</h4>
                        <div class="service-row">
                            <select class="service-select" data-shift="evening">
                                <option value="">اختر الخدمة</option>
                                <option value="cleaning">النظافة</option>
                                <option value="buffet">البوفيه</option>
                                <option value="security">الأمن</option>
                                <option value="maintenance">الصيانة</option>
                            </select>
                            <input type="number" class="service-workers" min="0" value="0" placeholder="عدد العمال">
                            <button type="button" class="remove-service-btn" onclick="removeServiceRow(this)"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <button type="button" class="add-service-btn" onclick="addServiceRow('evening')">
                        <i class="fas fa-plus"></i> إضافة خدمة
                    </button>
                </div>
                
                <!-- الوردية الليلية -->
                <div class="shift-card" id="nightShift">
                    <div class="shift-header">
                        <h3><i class="fas fa-star"></i> الوردية الليلية</h3>
                        <div class="time-selection">
                            <div class="time-group">
                                <label>من</label>
                                <input type="time" id="nightStart" class="form-control" style="width: auto;" value="00:00">
                            </div>
                            <div class="time-group">
                                <label>إلى</label>
                                <input type="time" id="nightEnd" class="form-control" style="width: auto;" value="08:00">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-male"></i> عدد العمال الذكور</label>
                            <input type="number" class="workforce-input male-workers" min="0" value="0" data-shift="night" oninput="updateWorkforceStats()">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-female"></i> عدد العمال الإناث</label>
                            <input type="number" class="workforce-input female-workers" min="0" value="0" data-shift="night" oninput="updateWorkforceStats()">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-user-tie"></i> عدد المشرفين الذكور</label>
                            <input type="number" class="workforce-input male-supervisors" min="0" value="0" data-shift="night" oninput="updateWorkforceStats()">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-user-tie"></i> عدد المشرفين الإناث</label>
                            <input type="number" class="workforce-input female-supervisors" min="0" value="0" data-shift="night" oninput="updateWorkforceStats()">
                        </div>
                    </div>
                    
                    <!-- خدمات الوردية الليلية -->
                    <div class="service-rows" id="nightServices">
                        <h4><i class="fas fa-list"></i> الخدمات في هذه الوردية</h4>
                        <div class="service-row">
                            <select class="service-select" data-shift="night">
                                <option value="">اختر الخدمة</option>
                                <option value="cleaning">النظافة</option>
                                <option value="buffet">البوفيه</option>
                                <option value="security">الأمن</option>
                                <option value="maintenance">الصيانة</option>
                            </select>
                            <input type="number" class="service-workers" min="0" value="0" placeholder="عدد العمال">
                            <button type="button" class="remove-service-btn" onclick="removeServiceRow(this)"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <button type="button" class="add-service-btn" onclick="addServiceRow('night')">
                        <i class="fas fa-plus"></i> إضافة خدمة
                    </button>
                </div>
                
                <!-- الإحصائيات -->
                <div class="stats-section">
                    <h3><i class="fas fa-chart-bar"></i> إحصائيات العمالة</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="number" id="totalWorkforce">0</div>
                            <div class="label">إجمالي العمالة</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="totalMales">0</div>
                            <div class="label">إجمالي الذكور</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="totalFemales">0</div>
                            <div class="label">إجمالي الإناث</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="genderRatio">0% : 0%</div>
                            <div class="label">نسبة الذكور إلى الإناث</div>
                        </div>
                    </div>
                    
                    <!-- بديل الراحات -->
                    <div class="alternate-rest-field" id="alternateRestField">
                        <div class="form-row">
                            <div class="auto-field" style="flex: 1; background: #e8f5e9; border-color: #c8e6c9;">
                                <label><i class="fas fa-user-clock"></i> بديل الراحات (حساب تلقائي)</label>
                                <div class="value" id="alternateRestValue">0</div>
                                <small style="color: var(--gray); display: block; margin-top: 5px;">(إجمالي العمالة ÷ 6)</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="backToGeneral">
                        <i class="fas fa-arrow-right"></i> السابق
                    </button>
                    <button type="button" class="btn btn-next" id="nextToServices">
                        التالي <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Services Form - Step 3 -->
        <div class="form-container" id="servicesForm" style="display: none;">
            <div class="section-header">
                <div class="section-icon">
                    <i class="fas fa-concierge-bell"></i>
                </div>
                <div>
                    <h2>الخدمات والبنود</h2>
                    <p>اختر الخدمات المطلوبة وحدد التفاصيل</p>
                </div>
            </div>
            
            <div class="section-body">
                <!-- Service Selection Dropdown -->
                <div class="service-dropdown-section">
                    <label for="serviceDropdown"><i class="fas fa-list"></i> اختر الخدمة المطلوبة</label>
                    <select class="service-dropdown" id="serviceDropdown" onchange="showServiceDetails(this.value)">
                        <option value="">-- اختر الخدمة --</option>
                        <option value="cleaning">خدمات النظافة العامة</option>
                        <option value="buffet">خدمات البوفيه</option>
                        <option value="facade">تنظيف واجهات المبنى</option>
                        <option value="pest">مكافحة الحشرات والقوارض</option>
                        <option value="licenses">تراخيص السيارات</option>
                        <option value="sanitization">التعقيم والتطهير</option>
                        <option value="marble">جلى الرخام</option>
                        <option value="chimney">تنظيف الهود</option>
                        <option value="maintenance">خدمات الصيانة</option>
                        <option value="carpet">غسيل السجاد والمفروشات</option>
                        <option value="landscape">الاند سكيب وصيانة النباتات</option>
                        <option value="drivers">سائقين</option>
                        <option value="reception">موظفين استقبال وإداريين</option>
                        <option value="assistance">خدمات معاونة ومساعدة</option>
                        <option value="warehouses">مخازن وعتالة</option>
                        <option value="atm">نظافة ماكينات الصراف الآلي</option>
                        <option value="production">عمال إنتاج</option>
                        <option value="catering">تقديم الوجبات والكوفي بريك</option>
                    </select>
                </div>
                
                <!-- Cleaning Service Details -->
                <div class="items-section" id="cleaningItems">
                    <div class="service-tabs">
                        <div class="service-tab active" data-tab="cleaning-tools">الأدوات</div>
                        <div class="service-tab" data-tab="cleaning-materials">الخامات</div>
                        <div class="service-tab" data-tab="cleaning-equipment">المعدات</div>
                    </div>
                    
                    <div class="tab-content active" id="cleaning-tools">
                        <button type="button" class="btn btn-primary add-item-btn" onclick="addCustomItem('cleaningToolsTable')">
                            <i class="fas fa-plus"></i> إضافة أداة جديدة
                        </button>
                        <table class="items-table" id="cleaningToolsTable">
                            <thead>
                                <tr>
                                    <th>اسم الأداة</th>
                                    <th>العدد</th>
                                    <th>الوحدة</th>
                                    <th>إجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ستملأ بواسطة الجافاسكريبت -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="cleaning-materials">
                        <button type="button" class="btn btn-primary add-item-btn" onclick="addCustomItem('cleaningMaterialsTable')">
                            <i class="fas fa-plus"></i> إضافة خامة جديدة
                        </button>
                        <table class="items-table" id="cleaningMaterialsTable">
                            <thead>
                                <tr>
                                    <th>اسم الخامة</th>
                                    <th>العدد</th>
                                    <th>الوحدة</th>
                                    <th>إجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ستملأ بواسطة الجافاسكريبت -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="cleaning-equipment">
                        <button type="button" class="btn btn-primary add-item-btn" onclick="addCustomItem('cleaningEquipmentTable')">
                            <i class="fas fa-plus"></i> إضافة معدة جديدة
                        </button>
                        <table class="items-table" id="cleaningEquipmentTable">
                            <thead>
                                <tr>
                                    <th>اسم المعدة</th>
                                    <th>العدد</th>
                                    <th>الوحدة</th>
                                    <th>إجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ستملأ بواسطة الجافاسكريبت -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Buffet Service Details -->
                <div class="items-section" id="buffetItems">
                    <div class="service-tabs">
                        <div class="service-tab active" data-tab="buffet-tools">أدوات البوفيه</div>
                        <div class="service-tab" data-tab="buffet-materials">خامات البوفيه</div>
                        <div class="service-tab" data-tab="buffet-equipment">معدات البوفيه</div>
                    </div>
                    
                    <div class="tab-content active" id="buffet-tools">
                        <button type="button" class="btn btn-primary add-item-btn" onclick="addCustomItem('buffetToolsTable')">
                            <i class="fas fa-plus"></i> إضافة أداة جديدة
                        </button>
                        <table class="items-table" id="buffetToolsTable">
                            <thead>
                                <tr>
                                    <th>اسم الأداة</th>
                                    <th>العدد</th>
                                    <th>الوحدة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ستملأ بواسطة الجافاسكريبت -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="buffet-materials">
                        <button type="button" class="btn btn-primary add-item-btn" onclick="addCustomItem('buffetMaterialsTable')">
                            <i class="fas fa-plus"></i> إضافة خامة جديدة
                        </button>
                        <table class="items-table" id="buffetMaterialsTable">
                            <thead>
                                <tr>
                                    <th>اسم الخامة</th>
                                    <th>العدد</th>
                                    <th>الوحدة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ستملأ بواسطة الجافاسكريبت -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="buffet-equipment">
                        <button type="button" class="btn btn-primary add-item-btn" onclick="addCustomItem('buffetEquipmentTable')">
                            <i class="fas fa-plus"></i> إضافة معدة جديدة
                        </button>
                        <table class="items-table" id="buffetEquipmentTable">
                            <thead>
                                <tr>
                                    <th>اسم المعدة</th>
                                    <th>العدد</th>
                                    <th>الوحدة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ستملأ بواسطة الجافاسكريبت -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Facade Service Details -->
                <div class="items-section" id="facadeItems">
                    <div class="service-tabs">
                        <div class="service-tab active" data-tab="facade-materials">خامات الواجهات</div>
                        <div class="service-tab" data-tab="facade-equipment">معدات الواجهات</div>
                    </div>
                    
                    <div class="tab-content active" id="facade-materials">
                        <button type="button" class="btn btn-primary add-item-btn" onclick="addCustomItem('facadeMaterialsTable')">
                            <i class="fas fa-plus"></i> إضافة خامة جديدة
                        </button>
                        <table class="items-table" id="facadeMaterialsTable">
                            <thead>
                                <tr>
                                    <th>اسم الخامة</th>
                                    <th>العدد</th>
                                    <th>الوحدة</th>
                                    <th>إجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ستملأ بواسطة الجافاسكريبت -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="facade-equipment">
                        <button type="button" class="btn btn-primary add-item-btn" onclick="addCustomItem('facadeEquipmentTable')">
                            <i class="fas fa-plus"></i> إضافة معدة جديدة
                        </button>
                        <table class="items-table" id="facadeEquipmentTable">
                            <thead>
                                <tr>
                                    <th>اسم المعدة</th>
                                    <th>العدد</th>
                                    <th>الوحدة</th>
                                    <th>إجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ستملأ بواسطة الجافاسكريبت -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Other Services (Generic) -->
                <div class="items-section" id="otherItems">
                    <div style="text-align: center; padding: 40px 20px;">
                        <i class="fas fa-cogs" style="font-size: 4rem; color: var(--primary); margin-bottom: 20px;"></i>
                        <h3 style="color: var(--primary); margin-bottom: 15px;">تفاصيل الخدمة</h3>
                        <p style="color: var(--gray); max-width: 500px; margin: 0 auto;">قم بإدخال التفاصيل المطلوبة للخدمة المحددة.</p>
                        <div style="margin-top: 30px;">
                            <div class="form-group">
                                <label style="display: block; margin-bottom: 10px; font-weight: 600;">وصف الخدمة</label>
                                <textarea id="serviceDescription" class="form-control" rows="4" placeholder="أدخل وصف مفصل للخدمة المطلوبة"></textarea>
                            </div>
                            <div class="form-group">
                                <label style="display: block; margin-bottom: 10px; font-weight: 600;">المتطلبات الخاصة</label>
                                <textarea id="serviceRequirements" class="form-control" rows="3" placeholder="أدخل المتطلبات الخاصة للخدمة"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="backToSchedule">
                        <i class="fas fa-arrow-right"></i> السابق
                    </button>
                    <button type="button" class="btn btn-primary" id="submitForm">
                        <i class="fas fa-paper-plane"></i> إرسال المعاينة
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h3>EPS <span>الخدمات المتكاملة</span></h3>
                    <p>شركة رائدة في تقديم خدمات متكاملة عالية الجودة</p>
                </div>
                <div class="contact-info">
                    <p><i class="fas fa-phone"></i> +123 456 7890</p>
                    <p><i class="fas fa-envelope"></i> info@eps-services.com</p>
                </div>
            </div>
            <div class="copyright">
                <p>© 2024 نظام معاينات EPS. جميع الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>

    <script>
        // بيانات التطبيق
        const services = [
            { id: 'cleaning', name: 'خدمات النظافة العامة', icon: 'fas fa-broom', description: 'تنظيف شامل للمباني والمرافق' },
            { id: 'buffet', name: 'خدمات البوفيه', icon: 'fas fa-utensils', description: 'توفير خدمات الطعام والشراب' },
            { id: 'facade', name: 'تنظيف واجهات المبنى', icon: 'fas fa-building', description: 'تنظيف الواجهات الزجاجية والحجرية' },
            { id: 'pest', name: 'مكافحة الحشرات والقوارض', icon: 'fas fa-bug', description: 'خدمات المكافحة المتكاملة' },
            { id: 'licenses', name: 'تراخيص السيارات', icon: 'fas fa-car', description: 'خدمات تراخيص وفك حجز السيارات' },
            { id: 'sanitization', name: 'التعقيم والتطهير', icon: 'fas fa-hand-sparkles', description: 'تعقيم شامل للمرافق' },
            { id: 'marble', name: 'جلى الرخام', icon: 'fas fa-gem', description: 'صقل وجلي الرخام والجرانيت' },
            { id: 'chimney', name: 'تنظيف الهود', icon: 'fas fa-fire', description: 'تنظيف شفاطات المطابخ' },
            { id: 'maintenance', name: 'الصيانة', icon: 'fas fa-tools', description: 'صيانة شاملة بجميع أنواعها' },
            { id: 'carpet', name: 'غسيل السجاد', icon: 'fas fa-rug', description: 'غسيل وتنظيف السجاد والمفروشات' },
            { id: 'landscape', name: 'الاند سكيب والنباتات', icon: 'fas fa-leaf', description: 'تصميم وصيانة الحدائق' },
            { id: 'drivers', name: 'سائقين', icon: 'fas fa-steering-wheel', description: 'توفير سائقين محترفين' },
            { id: 'reception', name: 'موظفين استقبال وإداريين', icon: 'fas fa-user-tie', description: 'خدمات إدارية واستقبال' },
            { id: 'assistance', name: 'خدمات معاونة ومساعدة', icon: 'fas fa-hands-helping', description: 'دعم ومساعدة في المهام' },
            { id: 'warehouses', name: 'مخازن وعتالة', icon: 'fas fa-warehouse', description: 'خدمات تخزين ونقل' },
            { id: 'atm', name: 'نظافة ماكينات الصراف الآلي', icon: 'fas fa-money-check-alt', description: 'تنظيف وصيانة أجهزة الصراف' },
            { id: 'production', name: 'عمال إنتاج', icon: 'fas fa-industry', description: 'عمالة إنتاج مؤهلة' },
            { id: 'catering', name: 'تقديم الوجبات والكوفي بريك', icon: 'fas fa-coffee', description: 'خدمات تقديم الطعام والقهوة' }
        ];

        // بيانات أدوات النظافة
        const cleaningTools = [
            { code: 'CT020', name: 'جردل بلاستك' },
            { code: 'CT021', name: 'جردل بالعصارة' },
            { code: 'CT022', name: 'شرشوبة' },
            { code: 'CT023', name: 'مقشة ناعمة باليد' },
            { code: 'CT024', name: 'مقشة خشنة باليد' },
            { code: 'CT025', name: 'مساحة باليد 60 سم' },
            { code: 'CT026', name: 'مساحة معدن 120سم' },
            { code: 'CT027', name: 'اكس ويزر زجاج' },
            { code: 'CT028', name: 'بلة زجاج' },
            { code: 'CT029', name: 'مقشة ملاعب' },
            { code: 'CT030', name: 'كادي حامل ادوات' },
            { code: 'CT031', name: 'جاروف بلاستك باليد' },
            { code: 'CT032', name: 'جاروف مقفول' },
            { code: 'CT033', name: 'فلات موب' },
            { code: 'CT034', name: 'فرش فلات موب' },
            { code: 'CT035', name: 'بخاخة فارغة' },
            { code: 'CT036', name: 'زعافة باليد' },
            { code: 'CT037', name: 'اسكليبر بلاستك' },
            { code: 'CT038', name: 'سكينة معجون' },
            { code: 'CT039', name: 'جاروف صاج' },
            { code: 'CT040', name: 'فرشة تواليت' },
            { code: 'CT041', name: 'فرشة ارضيات باليد' }
        ];

        const cleaningMaterials = [
            { code: 'CM029', name: 'صابون متعدد الاغراض 20 لتر' },
            { code: 'CM030', name: 'ديتول خام' },
            { code: 'CM031', name: 'ديتول اصلي' },
            { code: 'CM032', name: 'معطر ارضيات' },
            { code: 'CM033', name: 'معطر جو جليد' },
            { code: 'CM034', name: 'معطر جو الوردة' },
            { code: 'CM035', name: 'هربك بطة' },
            { code: 'CM036', name: 'مزيل صداء' },
            { code: 'CM037', name: 'كلور' },
            { code: 'CM038', name: 'صابون بريل' },
            { code: 'CM039', name: 'رايد بدون رائحة' },
            { code: 'CM040', name: 'بيرسول' },
            { code: 'CM041', name: 'ملمع استالس روما' },
            { code: 'CM042', name: 'ملمع استالس شانيو' },
            { code: 'CM043', name: 'كفروما شبك' },
            { code: 'CM044', name: 'افروزو قاعدة حمام' },
            { code: 'CM045', name: 'ليم' },
            { code: 'CM046', name: 'هاند سوب سائل 4 لتر' },
            { code: 'CM047', name: 'هاند سوب كمينا' },
            { code: 'CM048', name: 'مورال ملمع اخشاب' },
            { code: 'CM049', name: 'جلانس ملمع زجاج' },
            { code: 'CM050', name: 'مناديل سحب باكيت' },
            { code: 'CM051', name: 'مناديل بكر فاين' },
            { code: 'CM052', name: 'مناديل مكتب فاين' },
            { code: 'CM053', name: 'بليدج ملمع اخشاب' },
            { code: 'CM054', name: 'بليدج ملمع GDF' },
            { code: 'CM055', name: 'ملمع جلد' },
            { code: 'CM056', name: 'اسبونشة خشنة' },
            { code: 'CM057', name: 'سلك المونيوم قطع' },
            { code: 'CM058', name: 'سلك المونيوم لفة 5 ك' },
            { code: 'CM059', name: 'اكياس رابش بيضاء' },
            { code: 'CM060', name: 'اكياس رابش وسط' },
            { code: 'CM061', name: 'اكياس رابش جامبو' },
            { code: 'CM062', name: 'فوطة ارضيات زرقاء' },
            { code: 'CM063', name: 'فوطة بيضاء' },
            { code: 'CM064', name: 'فوطة صفراء' },
            { code: 'CM065', name: 'فوطة عيش النمل' },
            { code: 'CM066', name: 'جلدة اكس ويزر' },
            { code: 'CM067', name: 'فرش بلة زجاج' }
        ];

        const cleaningEquipment = [
            { code: 'MM050', name: 'سنجل دسك' },
            { code: 'MM051', name: 'هوفر شفط مياة 1 ماتور' },
            { code: 'MM052', name: 'هوفر شفط 3 ماتور' },
            { code: 'MM053', name: 'تونتك دسك بطارية' },
            { code: 'MM054', name: 'توينتك دسك كابل' },
            { code: 'MM055', name: 'رايد اون B90' },
            { code: 'MM056', name: 'رايد اون B120' },
            { code: 'MM057', name: 'رايد اون B 140' },
            { code: 'MM058', name: 'تروالي حدمة عامة' },
            { code: 'MM059', name: 'برويطه' },
            { code: 'MM060', name: 'بلور هواء' },
            { code: 'MM061', name: 'تلسكوب 6 متر' },
            { code: 'MM062', name: 'تلسكوب 9 متر' },
            { code: 'MM063', name: 'علامات تحزير' },
            { code: 'MM064', name: 'اسويبر مانول' },
            { code: 'MM065', name: 'ماكينة بخار' },
            { code: 'MM066', name: 'ماكينة حقن وشفط' },
            { code: 'MM067', name: 'هايبرشر' },
            { code: 'MM068', name: 'كوريك اعمال حفر' },
            { code: 'MM069', name: 'خزان مياة فارغ 500 لتر' },
            { code: 'MM070', name: 'باسكت رابش مكتب' }
        ];

        // المتغيرات
        let currentStep = 1;
        let selectedMeal = null;
        let selectedTransportation = null;
        let currentService = null;
        let serviceData = {}; // تخزين بيانات الخدمات

        // تهيئة الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // تعيين التاريخ الحالي
            const now = new Date();
            const dateString = now.toLocaleDateString('ar-EG', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('autoDate').textContent = dateString;
            document.getElementById('currentDate').textContent = dateString;
            
            // محاولة الحصول على الموقع
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        document.getElementById('autoLocation').textContent = `${lat.toFixed(4)}°, ${lon.toFixed(4)}°`;
                    },
                    () => {
                        document.getElementById('autoLocation').textContent = 'غير متاح - يرجى السماح بالموقع';
                    }
                );
            } else {
                document.getElementById('autoLocation').textContent = 'غير مدعوم في هذا المتصفح';
            }
            
            // إنشاء جداول أدوات النظافة
            populateCleaningTable('cleaningToolsTable', cleaningTools);
            populateCleaningTable('cleaningMaterialsTable', cleaningMaterials);
            populateCleaningTable('cleaningEquipmentTable', cleaningEquipment);
            
            // إنشاء صفوف أولية للبوفيه
            addInitialBuffetRow('buffetToolsTable');
            addInitialBuffetRow('buffetMaterialsTable');
            addInitialBuffetRow('buffetEquipmentTable');
            
            // إنشاء صفوف أولية للواجهات
            addInitialFacadeRow('facadeMaterialsTable');
            addInitialFacadeRow('facadeEquipmentTable');
            
            // إضافة المستمعين للأحداث
            setupEventListeners();
            
            // التحقق من عدد أيام العمل الأولي
            checkWorkDays();
            
            // إضافة مستمعين لأيقونات الوجبات والتنقلات
            setupIconSelection();
            
            // إضافة مستمع للأزرار في جداول البنود
            setupTableButtons();
        });

        // إعداد مستمعي الأحداث لأيقونات الاختيار
        function setupIconSelection() {
            // أيقونات الوجبات
            document.querySelectorAll('#mealSelection .icon-option').forEach(option => {
                option.addEventListener('click', function() {
                    // إزالة التحديد من جميع الخيارات
                    document.querySelectorAll('#mealSelection .icon-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // إضافة التحديد للخيار المختار
                    this.classList.add('selected');
                    selectedMeal = this.dataset.value;
                });
            });
            
            // أيقونات التنقلات
            document.querySelectorAll('#transportationSelection .icon-option').forEach(option => {
                option.addEventListener('click', function() {
                    // إزالة التحديد من جميع الخيارات
                    document.querySelectorAll('#transportationSelection .icon-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // إضافة التحديد للخيار المختار
                    this.classList.add('selected');
                    selectedTransportation = this.dataset.value;
                });
            });
        }

        // تعبئة جداول النظافة
        function populateCleaningTable(tableId, items) {
            const tableBody = document.getElementById(tableId).querySelector('tbody');
            tableBody.innerHTML = '';
            
            items.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'item-row';
                row.innerHTML = `
                    <td>
                        <div class="item-name">
                            <i class="fas fa-cube"></i>
                            <div>
                                <div>${item.name}</div>
                                <small style="color: var(--gray);">${item.code}</small>
                            </div>
                        </div>
                    </td>
                    <td><input type="number" class="quantity-input" min="0" value="0" onchange="saveServiceData()"></td>
                    <td>
                        <select class="unit-select" onchange="saveServiceData()">
                            <option value="قطعة">قطعة</option>
                            <option value="زوج">زوج</option>
                            <option value="طقم">طقم</option>
                            <option value="كرتونة">كرتونة</option>
                        </select>
                    </td>
                    <td>
                        <button type="button" class="btn btn-secondary remove-row" style="padding: 5px 10px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // إضافة صف أولي للبوفيه
        function addInitialBuffetRow(tableId) {
            const tableBody = document.querySelector(`#${tableId} tbody`);
            addCustomItem(tableId, true);
        }

        // إضافة صف أولي للواجهات
        function addInitialFacadeRow(tableId) {
            const tableBody = document.querySelector(`#${tableId} tbody`);
            addCustomItem(tableId, true);
        }

        // إعداد أزرار الجداول
        function setupTableButtons() {
            document.addEventListener('click', function(e) {
                if (e.target.closest('.remove-row')) {
                    const row = e.target.closest('tr');
                    if (row) {
                        row.remove();
                        saveServiceData();
                    }
                }
            });
        }

        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // التنقل بين الخطوات
            document.getElementById('nextToSchedule').addEventListener('click', nextStep);
            document.getElementById('nextToServices').addEventListener('click', nextStep);
            
            document.getElementById('backToGeneral').addEventListener('click', prevStep);
            document.getElementById('backToSchedule').addEventListener('click', prevStep);
            
            // إعادة التعيين
            document.getElementById('resetBtn').addEventListener('click', resetForm);
            
            // إرسال النموذج
            document.getElementById('submitForm').addEventListener('click', submitForm);
            
            // تبديل علامات التبويب
            document.querySelectorAll('.service-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    const parentId = this.closest('.items-section').id;
                    
                    // إزالة النشاط من جميع علامات التبويب
                    document.querySelectorAll(`#${parentId} .service-tab`).forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // إضافة النشاط للعلامة الحالية
                    this.classList.add('active');
                    
                    // إخفاء جميع محتويات علامات التبويب
                    document.querySelectorAll(`#${parentId} .tab-content`).forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // عرض محتوى علامة التبويب الحالية
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        // التحقق من عدد أيام العمل
        function checkWorkDays() {
            const workDays = parseInt(document.getElementById('workDays').value) || 5;
            const alternateRestField = document.getElementById('alternateRestField');
            
            if (workDays > 5) {
                alternateRestField.classList.add('active');
                updateWorkforceStats(); // لحساب بديل الراحات
            } else {
                alternateRestField.classList.remove('active');
            }
        }

        // تحديث إحصائيات العمالة
        function updateWorkforceStats() {
            let totalWorkforce = 0;
            let totalMales = 0;
            let totalFemales = 0;
            
            // جمع بيانات العمالة من جميع الورديات
            const shifts = ['morning', 'evening', 'night'];
            
            shifts.forEach(shift => {
                // العمال الذكور
                const maleWorkers = document.querySelectorAll(`[data-shift="${shift}"].male-workers`);
                maleWorkers.forEach(input => {
                    const value = parseInt(input.value) || 0;
                    totalWorkforce += value;
                    totalMales += value;
                });
                
                // العمال الإناث
                const femaleWorkers = document.querySelectorAll(`[data-shift="${shift}"].female-workers`);
                femaleWorkers.forEach(input => {
                    const value = parseInt(input.value) || 0;
                    totalWorkforce += value;
                    totalFemales += value;
                });
                
                // المشرفين الذكور
                const maleSupervisors = document.querySelectorAll(`[data-shift="${shift}"].male-supervisors`);
                maleSupervisors.forEach(input => {
                    const value = parseInt(input.value) || 0;
                    totalWorkforce += value;
                    totalMales += value;
                });
                
                // المشرفين الإناث
                const femaleSupervisors = document.querySelectorAll(`[data-shift="${shift}"].female-supervisors`);
                femaleSupervisors.forEach(input => {
                    const value = parseInt(input.value) || 0;
                    totalWorkforce += value;
                    totalFemales += value;
                });
                
                // عمال الخدمات
                const serviceWorkers = document.querySelectorAll(`#${shift}Services .service-workers`);
                serviceWorkers.forEach(input => {
                    const value = parseInt(input.value) || 0;
                    totalWorkforce += value;
                    // نعتبر أن جميع عمال الخدمات ذكور (يمكن تعديله حسب الحاجة)
                    totalMales += value;
                });
            });
            
            // تحديث العناصر
            document.getElementById('totalWorkforce').textContent = totalWorkforce;
            document.getElementById('totalMales').textContent = totalMales;
            document.getElementById('totalFemales').textContent = totalFemales;
            
            // حساب النسبة
            if (totalWorkforce > 0) {
                const malePercent = Math.round((totalMales / totalWorkforce) * 100);
                const femalePercent = Math.round((totalFemales / totalWorkforce) * 100);
                document.getElementById('genderRatio').textContent = `${malePercent}% ذكور : ${femalePercent}% إناث`;
            } else {
                document.getElementById('genderRatio').textContent = '0% : 0%';
            }
            
            // حساب بديل الراحات إذا كانت أيام العمل أكثر من 5
            const workDays = parseInt(document.getElementById('workDays').value) || 5;
            if (workDays > 5 && totalWorkforce > 0) {
                const alternateRest = Math.ceil(totalWorkforce / 6);
                document.getElementById('alternateRestValue').textContent = alternateRest;
            }
        }

        // إضافة صف خدمة جديد للوردية
        function addServiceRow(shift) {
            const servicesContainer = document.getElementById(`${shift}Services`);
            const serviceRow = document.createElement('div');
            serviceRow.className = 'service-row';
            serviceRow.innerHTML = `
                <select class="service-select" data-shift="${shift}">
                    <option value="">اختر الخدمة</option>
                    <option value="cleaning">النظافة</option>
                    <option value="buffet">البوفيه</option>
                    <option value="security">الأمن</option>
                    <option value="maintenance">الصيانة</option>
                </select>
                <input type="number" class="service-workers" min="0" value="0" placeholder="عدد العمال" oninput="updateWorkforceStats()">
                <button type="button" class="remove-service-btn" onclick="removeServiceRow(this)"><i class="fas fa-trash"></i></button>
            `;
            
            // إضافة الصف قبل زر الإضافة
            const addButton = servicesContainer.nextElementSibling;
            servicesContainer.appendChild(serviceRow);
            
            // إضافة مستمع حدث للحقل الجديد
            serviceRow.querySelector('.service-workers').addEventListener('input', updateWorkforceStats);
        }

        // حذف صف خدمة
        function removeServiceRow(button) {
            const serviceRow = button.closest('.service-row');
            if (serviceRow) {
                serviceRow.remove();
                updateWorkforceStats();
            }
        }

        // إضافة عنصر مخصص
        function addCustomItem(tableId, isInitial = false) {
            const tableBody = document.querySelector(`#${tableId} tbody`);
            const newRow = document.createElement('tr');
            newRow.className = 'item-row';
            
            newRow.innerHTML = `
                <td><input type="text" class="form-control item-name-input" placeholder="أدخل اسم ${getItemType(tableId)}" ${isInitial ? 'value="' + getDefaultItemName(tableId) + '"' : ''} onchange="saveServiceData()"></td>
                <td><input type="number" class="quantity-input" min="1" value="1" onchange="saveServiceData()"></td>
                <td>
                    <select class="unit-select" onchange="saveServiceData()">
                        ${getUnitOptions(tableId)}
                    </select>
                </td>
                <td><button type="button" class="btn btn-secondary remove-row" style="padding: 5px 10px;"><i class="fas fa-trash"></i></button></td>
            `;
            
            tableBody.appendChild(newRow);
        }

        // الحصول على نوع العنصر بناءً على معرف الجدول
        function getItemType(tableId) {
            if (tableId.includes('Tools')) return 'الأداة';
            if (tableId.includes('Materials')) return 'الخامة';
            if (tableId.includes('Equipment')) return 'المعدة';
            return 'العنصر';
        }

        // الحصول على اسم افتراضي للعنصر
        function getDefaultItemName(tableId) {
            if (tableId === 'buffetToolsTable') return 'شوك وسكاكين';
            if (tableId === 'buffetMaterialsTable') return 'قهوة سريعة الذوبان';
            if (tableId === 'buffetEquipmentTable') return 'ماكينة قهوة';
            if (tableId === 'facadeMaterialsTable') return 'مادة تنظيف زجاج';
            if (tableId === 'facadeEquipmentTable') return 'سقالة متحركة';
            return 'عنصر جديد';
        }

        // الحصول على خيارات الوحدات بناءً على نوع الجدول
        function getUnitOptions(tableId) {
            if (tableId.includes('Materials')) {
                return `
                    <option value="كيلو">كيلو</option>
                    <option value="لتر">لتر</option>
                    <option value="علبة">علبة</option>
                    <option value="كرتونة">كرتونة</option>
                    <option value="قطعة">قطعة</option>
                `;
            } else {
                return `
                    <option value="قطعة">قطعة</option>
                    <option value="زوج">زوج</option>
                    <option value="طقم">طقم</option>
                    <option value="كرتونة">كرتونة</option>
                    <option value="مجموعة">مجموعة</option>
                `;
            }
        }

        // الانتقال للخطوة التالية
        function nextStep() {
            if (currentStep === 1) {
                // التحقق من صحة البيانات في الخطوة الأولى
                if (!validateGeneralInfo()) return;
                
                // إخفاء النموذج الحالي وإظهار التالي
                document.getElementById('generalInfoForm').style.display = 'none';
                document.getElementById('scheduleForm').style.display = 'block';
                
                // تحديث خطوات التقدم
                document.getElementById('step1').classList.remove('active');
                document.getElementById('step1').classList.add('completed');
                document.getElementById('step2').classList.add('active');
                document.getElementById('progressBar').style.width = '66%';
                
                currentStep = 2;
            } else if (currentStep === 2) {
                // التحقق من صحة البيانات في الخطوة الثانية
                if (!validateSchedule()) return;
                
                // إخفاء النموذج الحالي وإظهار التالي
                document.getElementById('scheduleForm').style.display = 'none';
                document.getElementById('servicesForm').style.display = 'block';
                
                // تحديث خطوات التقدم
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step2').classList.add('completed');
                document.getElementById('step3').classList.add('active');
                document.getElementById('progressBar').style.width = '100%';
                
                currentStep = 3;
            }
        }

        // العودة للخطوة السابقة
        function prevStep() {
            if (currentStep === 2) {
                // العودة من المواعيد إلى المعلومات العامة
                document.getElementById('scheduleForm').style.display = 'none';
                document.getElementById('generalInfoForm').style.display = 'block';
                
                // تحديث خطوات التقدم
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step1').classList.remove('completed');
                document.getElementById('step1').classList.add('active');
                document.getElementById('progressBar').style.width = '33%';
                
                currentStep = 1;
            } else if (currentStep === 3) {
                // العودة من الخدمات إلى المواعيد
                document.getElementById('servicesForm').style.display = 'none';
                document.getElementById('scheduleForm').style.display = 'block';
                
                // تحديث خطوات التقدم
                document.getElementById('step3').classList.remove('active');
                document.getElementById('step2').classList.remove('completed');
                document.getElementById('step2').classList.add('active');
                document.getElementById('progressBar').style.width = '66%';
                
                currentStep = 2;
            }
        }

        // التحقق من صحة المعلومات العامة
        function validateGeneralInfo() {
            const establishmentName = document.getElementById('establishmentName').value;
            const establishmentAddress = document.getElementById('establishmentAddress').value;
            const responsiblePerson = document.getElementById('responsiblePerson').value;
            const responsiblePhone = document.getElementById('responsiblePhone').value;
            const inspectorName = document.getElementById('inspectorName').value;
            
            if (!establishmentName.trim()) {
                alert('يرجى إدخال اسم المنشأة');
                return false;
            }
            
            if (!establishmentAddress.trim()) {
                alert('يرجى إدخال عنوان المنشأة');
                return false;
            }
            
            if (!responsiblePerson.trim()) {
                alert('يرجى إدخال اسم الشخص المسؤول');
                return false;
            }
            
            if (!responsiblePhone.trim()) {
                alert('يرجى إدخال رقم تليفون الشخص المسؤول');
                return false;
            }
            
            if (!inspectorName.trim()) {
                alert('يرجى إدخال اسم القائم بالمعاينة');
                return false;
            }
            
            return true;
        }

        // التحقق من صحة المواعيد
        function validateSchedule() {
            const workDays = parseInt(document.getElementById('workDays').value) || 0;
            
            if (workDays < 1) {
                alert('يرجى إدخال عدد أيام العمل (على الأقل يوم واحد)');
                return false;
            }
            
            return true;
        }

        // عرض تفاصيل الخدمة المختارة
        function showServiceDetails(serviceId) {
            // حفظ بيانات الخدمة الحالية قبل التبديل
            saveServiceData();
            
            // إخفاء جميع أقسام الخدمات
            document.querySelectorAll('.items-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // تحديد الخدمة الحالية
            currentService = serviceId;
            
            // عرض قسم الخدمة المختارة
            if (serviceId === 'cleaning') {
                document.getElementById('cleaningItems').classList.add('active');
            } else if (serviceId === 'buffet') {
                document.getElementById('buffetItems').classList.add('active');
            } else if (serviceId === 'facade') {
                document.getElementById('facadeItems').classList.add('active');
            } else if (serviceId) {
                document.getElementById('otherItems').classList.add('active');
            }
        }

        // حفظ بيانات الخدمة الحالية
        function saveServiceData() {
            if (!currentService) return;
            
            serviceData[currentService] = collectServiceData(currentService);
        }

        // الحصول على بيانات الخدمة
        function collectServiceData(serviceId) {
            if (serviceId === 'cleaning') {
                return {
                    type: 'cleaning',
                    materials: getTableData('cleaningMaterialsTable'),
                    tools: getTableData('cleaningToolsTable'),
                    equipment: getTableData('cleaningEquipmentTable')
                };
            } else if (serviceId === 'buffet') {
                return {
                    type: 'buffet',
                    materials: getTableData('buffetMaterialsTable'),
                    tools: getTableData('buffetToolsTable'),
                    equipment: getTableData('buffetEquipmentTable')
                };
            } else if (serviceId === 'facade') {
                return {
                    type: 'facade',
                    materials: getTableData('facadeMaterialsTable'),
                    equipment: getTableData('facadeEquipmentTable')
                };
            } else {
                return {
                    type: serviceId,
                    description: document.getElementById('serviceDescription').value || '',
                    requirements: document.getElementById('serviceRequirements').value || ''
                };
            }
        }

        // الحصول على بيانات الجدول
        function getTableData(tableId) {
            const items = [];
            const rows = document.querySelectorAll(`#${tableId} .item-row`);
            
            rows.forEach(row => {
                const nameInput = row.querySelector('.item-name-input, .item-name div');
                const qtyInput = row.querySelector('.quantity-input');
                const unitSelect = row.querySelector('.unit-select');
                
                let name = '';
                if (nameInput.classList.contains('item-name-input')) {
                    name = nameInput.value.trim();
                } else {
                    // للجداول المملوءة مسبقاً
                    const nameDiv = nameInput.querySelector('div:first-child');
                    name = nameDiv ? nameDiv.textContent.trim() : '';
                }
                
                const qty = parseFloat(qtyInput.value) || 0;
                const unit = unitSelect ? unitSelect.value : 'قطعة';
                
                if (name && qty > 0) {
                    items.push({
                        name: name,
                        qty: qty,
                        unit: unit
                    });
                }
            });
            
            return items;
        }

        // الحصول على بيانات العمالة للوردية
        function getShiftWorkforce(shift) {
            const maleWorkers = parseInt(document.querySelector(`[data-shift="${shift}"].male-workers`).value) || 0;
            const femaleWorkers = parseInt(document.querySelector(`[data-shift="${shift}"].female-workers`).value) || 0;
            const maleSupervisors = parseInt(document.querySelector(`[data-shift="${shift}"].male-supervisors`).value) || 0;
            const femaleSupervisors = parseInt(document.querySelector(`[data-shift="${shift}"].female-supervisors`).value) || 0;
            
            return {
                maleWorkers: maleWorkers,
                femaleWorkers: femaleWorkers,
                maleSupervisors: maleSupervisors,
                femaleSupervisors: femaleSupervisors,
                total: maleWorkers + femaleWorkers + maleSupervisors + femaleSupervisors
            };
        }

        // تجميع جميع بيانات الخدمات
        function collectAllServicesData() {
            const services = {};
            
            // تنظيف
            const cleaningData = collectServiceData('cleaning');
            if (cleaningData.materials.length > 0 || cleaningData.tools.length > 0 || cleaningData.equipment.length > 0) {
                services.cleaning = cleaningData;
            }
            
            // بوفيه
            const buffetData = collectServiceData('buffet');
            if (buffetData.materials.length > 0 || buffetData.tools.length > 0 || buffetData.equipment.length > 0) {
                services.buffet = buffetData;
            }
            
            // واجهات
            const facadeData = collectServiceData('facade');
            if (facadeData.materials.length > 0 || facadeData.equipment.length > 0) {
                services.facade = facadeData;
            }
            
            // الخدمات الأخرى
            const serviceDropdown = document.getElementById('serviceDropdown');
            const selectedService = serviceDropdown.value;
            if (selectedService && selectedService !== 'cleaning' && selectedService !== 'buffet' && selectedService !== 'facade') {
                const otherData = collectServiceData(selectedService);
                if (otherData.description || otherData.requirements) {
                    services[selectedService] = otherData;
                }
            }
            
            return services;
        }

        // دالة الإرسال الرئيسية
        function submitForm() {
            const submitBtn = document.getElementById('submitForm');
            const originalBtnText = submitBtn.innerHTML;
            
            // عرض حالة التحميل
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';
            submitBtn.disabled = true;
            
            try {
                // 1. تجميع البيانات من النموذج
                const formData = {
                    generalInfo: {
                        establishmentName: document.getElementById('establishmentName').value || "غير محدد",
                        establishmentAddress: document.getElementById('establishmentAddress').value || "",
                        responsiblePerson: document.getElementById('responsiblePerson').value || "",
                        responsiblePhone: document.getElementById('responsiblePhone').value || "",
                        inspectorName: document.getElementById('inspectorName').value || "",
                        inspectionDate: document.getElementById('autoDate').textContent,
                        location: document.getElementById('autoLocation').textContent
                    },
                    schedule: {
                        workDays: document.getElementById('workDays').value || 1,
                        totalWorkforce: document.getElementById('totalWorkforce').textContent || "0",
                        morningShift: { workforce: getShiftWorkforce('morning') },
                        eveningShift: { workforce: getShiftWorkforce('evening') },
                        nightShift: { workforce: getShiftWorkforce('night') },
                        meal: selectedMeal || "none",
                        transportation: selectedTransportation || "none"
                    },
                    services: collectAllServicesData()
                };
                
                console.log("Form Data Prepared:", formData);
                
                // 2. رابط Google Apps Script - ضع رابطك هنا
                const scriptURL = 'https://script.google.com/macros/s/AKfycbxh1jd6D-JmQtBOk95QwadEWVJsyDhZMTnz8Q2Nab_fUKBJIEKIdO6Yvk7cRTVsjjMf8A/exec';
                
                // 3. إرسال البيانات
                fetch(scriptURL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                    redirect: 'follow'
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(result => {
                    console.log("Server Response:", result);
                    
                    try {
                        const data = JSON.parse(result);
                        if (data.success) {
                            alert(`✅ تم إرسال المعاينة بنجاح!\n\nتم إنشاء ورقة جديدة باسم:\n"${formData.generalInfo.establishmentName}"\n\nرقم المعاينة: EPS-${new Date().getTime()}`);
                            resetForm();
                        } else {
                            alert(`⚠️ حدث خطأ: ${data.message || 'غير معروف'}`);
                        }
                    } catch (e) {
                        // إذا لم يكن الرد JSON، نفترض النجاح
                        alert(`✅ تم إرسال المعاينة بنجاح!\n\nتم إنشاء ورقة جديدة باسم:\n"${formData.generalInfo.establishmentName}"\n\nيمكنك فتح Google Sheets للتحقق من البيانات.`);
                        resetForm();
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert(`❌ فشل الإرسال: ${error.message}\n\nيرجى:\n1. التحقق من اتصال الإنترنت\n2. التأكد من نشر التطبيق كـ Web App\n3. المحاولة مرة أخرى`);
                })
                .finally(() => {
                    // استعادة حالة الزر
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                });
                
            } catch (error) {
                console.error("Form Error:", error);
                alert(`❌ خطأ في تجميع البيانات: ${error.message}`);
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
            }
        }

        // إعادة تعيين النموذج
        function resetForm() {
            if (confirm('هل أنت متأكد من إعادة تعيين النموذج؟ سيتم فقد جميع البيانات المدخلة.')) {
                // إعادة تعيين جميع حقول الإدخال
                document.querySelectorAll('input, select, textarea').forEach(element => {
                    if (element.type === 'text' || element.type === 'textarea' || element.type === 'tel') {
                        element.value = '';
                    } else if (element.type === 'number') {
                        if (element.id === 'workDays') {
                            element.value = '5';
                        } else if (element.classList.contains('workforce-input') || element.classList.contains('service-workers')) {
                            element.value = '0';
                        } else if (element.classList.contains('quantity-input')) {
                            element.value = '0';
                        } else {
                            element.value = '';
                        }
                    } else if (element.type === 'select-one') {
                        element.selectedIndex = 0;
                    } else if (element.type === 'time') {
                        if (element.id === 'morningStart') element.value = '08:00';
                        if (element.id === 'morningEnd') element.value = '16:00';
                        if (element.id === 'eveningStart') element.value = '16:00';
                        if (element.id === 'eveningEnd') element.value = '00:00';
                        if (element.id === 'nightStart') element.value = '00:00';
                        if (element.id === 'nightEnd') element.value = '08:00';
                    }
                });
                
                // إعادة تعيين أيقونات الاختيار
                document.querySelectorAll('.icon-option').forEach(option => {
                    option.classList.remove('selected');
                });
                selectedMeal = null;
                selectedTransportation = null;
                
                // إعادة تعيين خطوات التقدم
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active', 'completed');
                });
                document.getElementById('step1').classList.add('active');
                document.getElementById('progressBar').style.width = '33%';
                
                // إعادة تعيين أقسام الخدمات
                document.querySelectorAll('.items-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById('serviceDropdown').selectedIndex = 0;
                currentService = null;
                serviceData = {};
                
                // إعادة تعيين جداول النظافة
                populateCleaningTable('cleaningToolsTable', cleaningTools);
                populateCleaningTable('cleaningMaterialsTable', cleaningMaterials);
                populateCleaningTable('cleaningEquipmentTable', cleaningEquipment);
                
                // إعادة تعيين جداول البوفيه والواجهات
                ['buffetToolsTable', 'buffetMaterialsTable', 'buffetEquipmentTable', 
                 'facadeMaterialsTable', 'facadeEquipmentTable'].forEach(tableId => {
                    const tableBody = document.querySelector(`#${tableId} tbody`);
                    tableBody.innerHTML = '';
                    if (tableId.includes('buffet')) {
                        addInitialBuffetRow(tableId);
                    } else if (tableId.includes('facade')) {
                        addInitialFacadeRow(tableId);
                    }
                });
                
                // إعادة تعيين صفوف الخدمات في الورديات
                document.querySelectorAll('.service-rows').forEach(container => {
                    const rows = container.querySelectorAll('.service-row');
                    rows.forEach((row, index) => {
                        if (index > 0) row.remove();
                    });
                });
                
                // إعادة تعيين العرض للخطوة الأولى
                document.getElementById('scheduleForm').style.display = 'none';
                document.getElementById('servicesForm').style.display = 'none';
                document.getElementById('generalInfoForm').style.display = 'block';
                
                currentStep = 1;
                
                // تحديث التاريخ والموقع
                const now = new Date();
                const dateString = now.toLocaleDateString('ar-EG', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                document.getElementById('autoDate').textContent = dateString;
                document.getElementById('currentDate').textContent = dateString;
                
                // إعادة تعيين بديل الراحات
                document.getElementById('alternateRestField').classList.remove('active');
                document.getElementById('alternateRestValue').textContent = '0';
                
                // تحديث الإحصائيات
                updateWorkforceStats();
            }
        }

        // تحديث إحصائيات العمالة عند التحميل
        updateWorkforceStats();
    </script>
</body>
</html>



